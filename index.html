<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Owen's Docs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=EB+Garamond&family=JetBrains+Mono&family=Inter:wght@400;700&family=Roboto+Slab&family=Caveat:wght@700&display=swap');
        
        #login-screen { transition: opacity 0.3s; }
        .hidden-fade { opacity: 0; pointer-events: none; }
        
        #edit-content { min-height: 600px; outline: none; line-height: 1.6; position: relative; }
        #edit-content a { color: #2563eb; text-decoration: underline; }

        .resizable-img { position: relative; display: inline-block; margin: 15px 0; line-height: 0; cursor: default; max-width: 100%; }
        .resizable-img img { width: 100%; height: auto; border-radius: 8px; display: block; pointer-events: none; }
        .resizable-img.selected { outline: 3px solid #3b82f6; }
        .resize-handle { 
            position: absolute; bottom: -8px; right: -8px; width: 16px; height: 16px; 
            background: #3b82f6; border-radius: 50%; cursor: nwse-resize; display: none; z-index: 10;
        }
        .selected .resize-handle { display: block; }

        .font-sans { font-family: 'Inter', sans-serif; }
        .font-serif { font-family: 'EB Garamond', serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .font-slab { font-family: 'Roboto Slab', serif; }
        .font-hand { font-family: 'Caveat', cursive; font-size: 1.4rem; }

        .spinner { display: inline-block; width: 14px; height: 14px; border: 2px solid rgba(0,0,0,.15); border-radius: 50%; border-top-color: #000; animation: spin 0.8s linear infinite; margin-right: 6px; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans overflow-x-hidden">

    <div id="toast-container" class="fixed bottom-5 right-5 z-[100] flex flex-col gap-2"></div>
    <input type="file" id="image-input" accept="image/*" class="hidden">

    <div id="login-screen" class="fixed inset-0 bg-white z-[70] flex flex-col items-center justify-center">
        <h1 class="text-4xl font-bold text-slate-800 mb-6 italic tracking-tighter">Owen's Docs</h1>
        <button id="login-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-10 py-3 rounded-2xl font-bold shadow-xl active:scale-95 transition-all">
            <i class="fab fa-google mr-2"></i> Sign in with Google
        </button>
    </div>

    <div id="custom-modal" class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm hidden z-[80] flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl p-8 max-w-sm w-full shadow-2xl">
            <h3 id="modal-title" class="text-xl font-bold text-slate-800 mb-2"></h3>
            <p id="modal-desc" class="text-slate-500 text-sm mb-6"></p>
            <input id="modal-input" type="text" class="hidden w-full p-4 border rounded-xl mb-6 outline-none focus:ring-2 ring-blue-500" placeholder="Paste link here...">
            <div class="flex gap-4 justify-end">
                <button id="modal-cancel" class="text-slate-400 font-bold text-sm">Cancel</button>
                <button id="modal-confirm" class="bg-blue-600 text-white px-6 py-2 rounded-xl font-bold text-sm">Confirm</button>
            </div>
        </div>
    </div>

    <div id="enhance-modal" class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm hidden z-[80] flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl p-8 max-w-sm w-full shadow-2xl">
            <h3 class="text-xl font-bold text-slate-800 mb-6">Enhance as:</h3>
            <div class="space-y-3">
                <button class="enhance-type-btn w-full bg-slate-100 hover:bg-blue-100 text-slate-800 px-4 py-3 rounded-xl text-left font-semibold transition" data-type="email">Email</button>
                <button class="enhance-type-btn w-full bg-slate-100 hover:bg-blue-100 text-slate-800 px-4 py-3 rounded-xl text-left font-semibold transition" data-type="essay">Essay</button>
                <button class="enhance-type-btn w-full bg-slate-100 hover:bg-blue-100 text-slate-800 px-4 py-3 rounded-xl text-left font-semibold transition" data-type="blog">Blog Post</button>
                <button class="enhance-type-btn w-full bg-slate-100 hover:bg-blue-100 text-slate-800 px-4 py-3 rounded-xl text-left font-semibold transition" data-type="formal">Formal Document</button>
                <button class="enhance-type-btn w-full bg-slate-100 hover:bg-blue-100 text-slate-800 px-4 py-3 rounded-xl text-left font-semibold transition" data-type="notes">Notes</button>
            </div>
            <button id="enhance-cancel" class="w-full mt-4 text-slate-400 font-bold text-sm hover:text-slate-600">Cancel</button>
        </div>
    </div>

    <nav id="main-nav" class="hidden bg-white border-b px-8 py-4 flex justify-between items-center sticky top-0 z-10">
        <h2 class="text-xl font-black text-slate-800 uppercase tracking-tighter">Owen's docs</h2>
        <button id="logout-btn" class="text-red-500 font-black text-[10px] tracking-widest uppercase">Logout</button>
    </nav>

    <main id="dashboard" class="hidden max-w-6xl mx-auto p-8">
        <div id="admin-management" class="hidden mb-12 bg-white p-6 rounded-3xl border border-slate-100 shadow-sm">
            <h4 class="text-[10px] font-black uppercase tracking-widest text-slate-400 mb-4">Authorized Users</h4>
            <div class="flex gap-2">
                <input id="new-user-email" type="email" placeholder="friend@gmail.com" class="flex-1 p-3 border rounded-xl outline-none focus:ring-2 ring-blue-500 text-sm">
                <button id="add-user-btn" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold text-sm hover:bg-blue-700 transition">Add User</button>
            </div>
            <div id="allowed-users-list" class="flex flex-wrap gap-2 mt-4"></div>
        </div>

        <div class="flex justify-between items-center mb-12">
            <h3 class="text-3xl font-bold text-slate-900">Workspace</h3>
            <button id="create-btn" class="bg-blue-600 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:shadow-blue-200 transition-all">
                <i class="fas fa-plus mr-2"></i> Newer Docs
            </button>
        </div>
        
        <div id="docs-container" class="space-y-12">
            </div>
    </main>

    <div id="editor-modal" class="fixed inset-0 bg-white hidden z-[60] flex flex-col">
        <div id="status-bar" class="bg-slate-900 text-white px-6 py-1.5 text-[9px] font-black uppercase tracking-widest text-center"></div>

        <div class="p-4 border-b flex justify-between items-center bg-white shadow-sm">
            <div class="flex items-center gap-4 w-full">
                <button id="close-editor" class="text-slate-400 hover:text-slate-900 text-xl px-2"><i class="fas fa-arrow-left"></i></button>
                <input id="edit-title" type="text" class="text-xl font-bold outline-none w-full border-none" placeholder="Untitled">
            </div>
            <div class="flex items-center gap-4">
                <div id="save-indicator" class="text-[9px] font-black text-slate-400">SAVED</div>
                <button id="top-share-btn" class="bg-blue-600 text-white px-4 py-2 rounded-xl text-xs font-bold transition hover:bg-blue-700">Share</button>
                <button id="export-pdf-btn" class="bg-slate-100 hover:bg-slate-200 px-5 py-2 rounded-xl text-xs font-bold text-slate-700 transition">PDF</button>
            </div>
        </div>

        <div id="admin-toolbar" class="bg-slate-50 border-b p-2 flex flex-wrap gap-2 justify-center sticky top-0 z-20">
            <select id="font-select" class="text-xs font-bold border rounded-lg px-3 bg-white outline-none">
                <option value="font-sans">Modern Sans</option>
                <option value="font-serif">Classic Serif</option>
                <option value="font-mono">Mono Code</option>
                <option value="font-slab">Roboto Slab</option>
                <option value="font-hand">Handwritten</option>
            </select>
            <div class="w-px h-6 bg-slate-200 mx-2"></div>
            <button onclick="document.execCommand('bold')" class="p-2 hover:bg-slate-200 rounded-lg"><i class="fas fa-bold"></i></button>
            <button onclick="document.execCommand('italic')" class="p-2 hover:bg-slate-200 rounded-lg"><i class="fas fa-italic"></i></button>
            <button id="btn-link" class="p-2 hover:bg-blue-50 text-blue-600 rounded-lg"><i class="fas fa-link"></i></button>
            <button id="btn-image" class="p-2 hover:bg-emerald-50 text-emerald-600 rounded-lg"><i class="fas fa-image"></i> Image</button>
            <div class="w-px h-6 bg-slate-200 mx-2"></div>
            <button id="btn-ai-enhance" class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-1 rounded-lg text-xs font-bold transition">Enhance</button>
        </div>

        <div class="flex-1 overflow-y-auto bg-white" id="editor-container">
            <div id="edit-content" contenteditable="true" class="max-w-4xl mx-auto p-12 md:p-24 outline-none"></div>
        </div>

        <div id="editor-footer" class="p-4 border-t flex justify-between items-center bg-slate-50 px-8">
            <div id="admin-actions" class="flex gap-4">
                <div class="relative group">
                    <button id="share-menu-btn" class="bg-blue-600 text-white px-6 py-2 rounded-xl text-xs font-bold uppercase tracking-widest shadow-md">Access</button>
                    <div id="share-dropdown" class="hidden absolute bottom-full mb-3 left-0 w-64 bg-white border border-slate-100 shadow-2xl rounded-2xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <span class="text-xs font-black uppercase text-slate-400">Public Link</span>
                            <input type="checkbox" id="public-toggle" class="w-5 h-5 accent-blue-600">
                        </div>
                        <button id="copy-link-btn" class="hidden w-full bg-blue-50 text-blue-600 text-[10px] py-3 rounded-xl font-black uppercase tracking-tighter border border-blue-100">Copy Link</button>
                    </div>
                </div>
                <button id="delete-btn-trigger" class="text-slate-300 hover:text-red-500 p-2 transition"><i class="fas fa-trash-can"></i></button>
            </div>
            <div id="word-count" class="text-[9px] font-black text-slate-400 uppercase tracking-widest">0 Words</div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, get, set, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDqnZfCWAwU7KXJEGunzYAP5qfZJQVvExQ",
            authDomain: "imcrabpd.firebaseapp.com",
            databaseURL: "https://imcrabpd-default-rtdb.firebaseio.com",
            projectId: "imcrabpd",
            storageBucket: "imcrabpd.firebasestorage.app",
            messagingSenderId: "555027239107",
            appId: "1:555027239107:web:d4d58affb9b3dea996d276"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        const provider = new GoogleAuthProvider();
        const ADMIN_EMAIL = 'imcrabfr@gmail.com';
        const GROQ_API_KEY = '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';
        const GROQ_API_URL = 'https://api.groq.com/openai/v1/chat/completions';
        
        let currentDocId = null;
        let currentDocTitle = null;
        let currentUnsub = null;
        let isTyping = false;
        let saveTimer = null;
        let aiProcessing = false;

        // --- Utils ---
        function showToast(m) {
            const c = document.getElementById('toast-container');
            const t = document.createElement('div');
            t.className = "bg-slate-900 text-white px-6 py-3 rounded-xl shadow-2xl text-[10px] font-black uppercase";
            t.innerText = m;
            c.appendChild(t);
            setTimeout(() => t.remove(), 3000);
        }

        function openModal(title, desc, input, onConfirm) {
            const m = document.getElementById('custom-modal');
            const i = document.getElementById('modal-input');
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-desc').innerText = desc;
            i.classList.toggle('hidden', !input);
            m.classList.remove('hidden');
            document.getElementById('modal-confirm').onclick = () => { onConfirm(i.value); m.classList.add('hidden'); };
            document.getElementById('modal-cancel').onclick = () => m.classList.add('hidden');
        }

        function getDocNameFromUrl() {
            const path = window.location.pathname;
            const match = path.match(/\/([^/]+)\/?$/);
            return match ? decodeURIComponent(match[1]) : null;
        }

        // --- Auth & Multi-User Management ---
        onAuthStateChanged(auth, async (user) => {
            const urlDocName = getDocNameFromUrl();
            if (user) {
                const isAdmin = user.email === ADMIN_EMAIL;
                const allowedSnap = await get(ref(db, 'allowedUsers'));
                const allowedList = Object.values(allowedSnap.val() || {});
                const isAllowed = isAdmin || allowedList.includes(user.email);

                if (isAllowed) {
                    document.getElementById('login-screen').classList.add('hidden-fade');
                    document.getElementById('main-nav').classList.remove('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                    if (isAdmin) {
                        document.getElementById('admin-management').classList.remove('hidden');
                        loadAllowedUsers();
                    }
                    loadDashboard(user.email, isAdmin);
                    if (urlDocName && !['index.html', ''].includes(urlDocName)) loadDocByName(urlDocName);
                } else {
                    showToast("Access Denied: " + user.email);
                    signOut(auth);
                }
            } else if (urlDocName && !['index.html', ''].includes(urlDocName)) {
                loadDocByName(urlDocName);
            } else {
                document.getElementById('login-screen').classList.remove('hidden-fade');
            }
        });

        function loadAllowedUsers() {
            onValue(ref(db, 'allowedUsers'), (snap) => {
                const list = document.getElementById('allowed-users-list');
                list.innerHTML = '';
                Object.entries(snap.val() || {}).forEach(([key, email]) => {
                    const tag = document.createElement('div');
                    tag.className = "bg-slate-100 text-slate-600 px-3 py-1 rounded-full text-[10px] font-bold flex items-center gap-2";
                    tag.innerHTML = `${email} <i class="fas fa-times cursor-pointer hover:text-red-500" onclick="window.removeUser('${key}')"></i>`;
                    list.appendChild(tag);
                });
            });
        }
        window.removeUser = (key) => remove(ref(db, `allowedUsers/${key}`));
        document.getElementById('add-user-btn').onclick = () => {
            const i = document.getElementById('new-user-email');
            if (i.value.trim()) push(ref(db, 'allowedUsers'), i.value.trim());
            i.value = '';
        };

        function loadDashboard(userEmail, isAdmin) {
            onValue(ref(db, 'docs'), (s) => {
                const container = document.getElementById('docs-container');
                container.innerHTML = '';
                const data = s.val() || {};
                
                // Grouping Logic
                const groups = {};
                for (let id in data) {
                    const doc = data[id];
                    if (isAdmin || doc.owner === userEmail) {
                        const ownerKey = doc.owner || 'Legacy';
                        if (!groups[ownerKey]) groups[ownerKey] = [];
                        groups[ownerKey].push({ id, ...doc });
                    }
                }

                // Render Categorized Sections
                for (let owner in groups) {
                    const section = document.createElement('div');
                    const sectionTitle = owner === userEmail ? "My Projects" : `User: ${owner}`;
                    const gridId = `grid-${owner.replace(/[@.]/g, '')}`;

                    section.innerHTML = `
                        <h4 class="text-[10px] font-black uppercase tracking-widest text-slate-400 mb-6 border-b pb-2">${sectionTitle}</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="${gridId}"></div>
                    `;
                    container.appendChild(section);

                    const grid = section.querySelector(`#${gridId}`);
                    groups[owner].forEach(doc => {
                        const card = document.createElement('div');
                        card.className = "group bg-white p-8 rounded-3xl border border-slate-100 hover:border-blue-500 cursor-pointer shadow-sm hover:shadow-xl transition-all";
                        card.innerHTML = `
                            <div class="flex justify-between items-start">
                                <h4 class="font-bold truncate text-slate-800 pr-4">${doc.title || 'Untitled'}</h4>
                                <button onclick="event.stopPropagation(); window.quickDelete('${doc.id}')" class="opacity-0 group-hover:opacity-100 text-slate-300 hover:text-red-500 transition-all p-1">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        `;
                        card.onclick = () => openEditor(doc.id, doc);
                        grid.appendChild(card);
                    });
                }
            });
        }

        function loadDocByName(docName) {
            get(ref(db, 'docs')).then(s => {
                const docs = s.val();
                for (let id in docs) {
                    if (docs[id].title === docName && (docs[id].publicView || (auth.currentUser))) {
                        openEditor(id, docs[id]);
                        document.getElementById('login-screen').classList.add('hidden-fade');
                        return;
                    }
                }
                showToast('Document not found');
            });
        }

        // --- Editor Engine ---
        function openEditor(id, data) {
            currentDocId = id;
            currentDocTitle = data.title;
            const editContent = document.getElementById('edit-content');
            
            document.getElementById('edit-title').value = data.title;
            editContent.innerHTML = data.content || '';
            
            const isOwner = auth.currentUser && (auth.currentUser.email === data.owner || auth.currentUser.email === ADMIN_EMAIL);
            editContent.contentEditable = isOwner;
            
            document.getElementById('admin-toolbar').classList.toggle('hidden', !isOwner);
            document.getElementById('admin-actions').classList.toggle('hidden', !isOwner);
            
            const statusBar = document.getElementById('status-bar');
            statusBar.innerText = isOwner ? "Editing Enabled" : "Read-Only Mode";
            statusBar.className = isOwner ? "bg-blue-600 text-white px-6 py-1.5 text-[9px] font-black uppercase tracking-widest text-center" : "bg-slate-800 text-white px-6 py-1.5 text-[9px] font-black uppercase tracking-widest text-center";

            document.getElementById('public-toggle').checked = !!data.publicView;
            document.getElementById('copy-link-btn').classList.toggle('hidden', !data.publicView);
            
            editContent.className = `max-w-4xl mx-auto p-12 md:p-24 outline-none ${data.fontClass || 'font-sans'}`;
            document.getElementById('font-select').value = data.fontClass || 'font-sans';
            
            document.getElementById('editor-modal').classList.remove('hidden');
            window.history.pushState({}, '', `/${encodeURIComponent(data.title)}`);
            
            attachImageListeners();
            updateCount();

            if (currentUnsub) currentUnsub();
            currentUnsub = onValue(ref(db, `docs/${id}`), (snap) => {
                const d = snap.val();
                if (!d || isTyping) return;
                if (d.content !== editContent.innerHTML) {
                    editContent.innerHTML = d.content || '';
                    updateCount();
                    attachImageListeners();
                }
            });
        }

        const save = () => {
            if (!currentDocId || !auth.currentUser) return;
            document.getElementById('save-indicator').innerText = "SAVING...";
            update(ref(db, `docs/${currentDocId}`), {
                title: document.getElementById('edit-title').value,
                content: document.getElementById('edit-content').innerHTML,
                fontClass: document.getElementById('font-select').value,
                publicView: document.getElementById('public-toggle').checked
            }).then(() => document.getElementById('save-indicator').innerText = "SAVED");
        };

        // --- Multimedia & Images ---
        document.getElementById('btn-image').onclick = () => document.getElementById('image-input').click();
        document.getElementById('image-input').onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    const html = `<div class="resizable-img" contenteditable="false"><img src="${ev.target.result}"><div class="resize-handle"></div></div><p><br></p>`;
                    document.getElementById('edit-content').focus();
                    document.execCommand('insertHTML', false, html);
                    attachImageListeners();
                    save();
                };
                reader.readAsDataURL(file);
            }
        };

        function attachImageListeners() {
            document.querySelectorAll('.resizable-img').forEach(wrap => {
                wrap.onmousedown = (e) => {
                    document.querySelectorAll('.resizable-img').forEach(el => el.classList.remove('selected'));
                    wrap.classList.add('selected');
                    if (e.target.classList.contains('resize-handle')) {
                        e.preventDefault();
                        const startX = e.clientX;
                        const startW = wrap.offsetWidth;
                        const onMove = (mv) => wrap.style.width = (startW + (mv.clientX - startX)) + 'px';
                        const onUp = () => { document.removeEventListener('mousemove', onMove); document.removeEventListener('mouseup', onUp); save(); };
                        document.addEventListener('mousemove', onMove);
                        document.addEventListener('mouseup', onUp);
                    }
                };
            });
        }

        // --- AI ---
        async function enhanceTextWithAI() {
            if (aiProcessing) return;
            const sel = window.getSelection();
            const text = sel.toString().trim();
            if (!text) { showToast('Select text first'); return; }

            document.getElementById('enhance-modal').classList.remove('hidden');
            const selectedType = await new Promise(resolve => {
                const buttons = document.querySelectorAll('.enhance-type-btn');
                buttons.forEach(b => b.onclick = (e) => { 
                    document.getElementById('enhance-modal').classList.add('hidden'); 
                    resolve(e.target.dataset.type); 
                });
                document.getElementById('enhance-cancel').onclick = () => { 
                    document.getElementById('enhance-modal').classList.add('hidden'); 
                    resolve(null); 
                };
            });

            if (!selectedType) return;
            aiProcessing = true;
            const btn = document.getElementById('btn-ai-enhance');
            btn.innerHTML = '<div class="spinner"></div>Enhancing...';

            try {
                const resp = await fetch(GROQ_API_URL, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${GROQ_API_KEY}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'llama-3.3-70b-versatile',
                        messages: [{ role: 'user', content: `Enhance this as a ${selectedType}. Return ONLY enhanced text:\n\n${text}` }],
                        temperature: 0.6
                    })
                });
                const data = await resp.json();
                if (data.choices) {
                    document.execCommand('insertText', false, data.choices[0].message.content.trim());
                    save();
                }
            } catch (e) { showToast('AI Error'); }
            finally { aiProcessing = false; btn.innerHTML = 'Enhance'; }
        }

        // --- Core Listeners ---
        document.getElementById('btn-ai-enhance').onclick = enhanceTextWithAI;
        document.getElementById('edit-content').oninput = () => {
            isTyping = true;
            updateCount();
            if (saveTimer) clearTimeout(saveTimer);
            saveTimer = setTimeout(() => { isTyping = false; save(); }, 1200);
        };
        document.getElementById('font-select').onchange = save;
        document.getElementById('create-btn').onclick = () => {
            const n = push(ref(db, 'docs'));
            const d = { title: "Untitled Doc", content: "", owner: auth.currentUser.email, fontClass: 'font-sans', publicView: false };
            set(n, d).then(() => openEditor(n.key, d));
        };
        document.getElementById('login-btn').onclick = () => signInWithPopup(auth, provider);
        document.getElementById('logout-btn').onclick = () => signOut(auth).then(() => window.location.reload());
        document.getElementById('close-editor').onclick = () => { document.getElementById('editor-modal').classList.add('hidden'); window.history.pushState({}, '', '/'); };
        document.getElementById('export-pdf-btn').onclick = () => html2pdf().from(document.getElementById('edit-content')).save();
        document.getElementById('share-menu-btn').onclick = () => document.getElementById('share-dropdown').classList.toggle('hidden');
        document.getElementById('top-share-btn').onclick = () => document.getElementById('share-dropdown').classList.toggle('hidden');
        document.getElementById('public-toggle').onchange = save;
        document.getElementById('copy-link-btn').onclick = () => {
            navigator.clipboard.writeText(`${window.location.origin}/${encodeURIComponent(currentDocTitle)}`);
            showToast("Copied!");
        };
        document.getElementById('delete-btn-trigger').onclick = () => {
            openModal("Delete?", "Action is permanent.", false, () => {
                remove(ref(db, `docs/${currentDocId}`));
                document.getElementById('editor-modal').classList.add('hidden');
            });
        };
        window.quickDelete = (id) => remove(ref(db, `docs/${id}`));
        function updateCount() {
            const t = document.getElementById('edit-content').innerText;
            document.getElementById('word-count').innerText = (t.trim() ? t.trim().split(/\s+/).length : 0) + " Words";
        }
    </script>
</body>
</html>